<div class="card my-3">
  <div class="card-header text-center">
    <h5 class="card-title" style="color: blueviolet;">Ticket Management</h5>
    <div class="input-group">
      <input
        type="text"
        [(ngModel)]="searchTerm"
        (input)="filterTickets()"
        class="form-control"
        placeholder="Search by Ticket ID or Description"
      />
      <button class="btn btn-outline-secondary" type="button" (click)="clearSearch()">Clear</button>
    </div>
  </div>
  <div class="table-container">
    <div class="table-responsive mb-4 p-3 shadow rounded">
      <table class="table table-striped table-bordered mb-0">
        <thead class="table-light">
          <tr>
            <th style="width: 20px;">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="ticketCheckAll">
                <label class="form-check-label" for="ticketCheckAll"></label>
              </div>
            </th>
            <th class="align-middle" (click)="toggleSort('ticketId')" style="cursor: pointer;">
              Ticket ID <i class="fa" [ngClass]="{'fa-sort-up': sortColumn === 'ticketId' && sortOrder, 'fa-sort-down': sortColumn === 'ticketId' && !sortOrder}"></i>
            </th>      
        <th class="align-middle" (click)="toggleSort('description')" style="cursor: pointer;">
        Description <i class="fa" [ngClass]="{'fa-sort-up': sortColumn === 'description' && sortOrder, 'fa-sort-down': sortColumn === 'description' && !sortOrder}"></i>
      </th>
    <th class="align-middle" (click)="toggleSort('status')" style="cursor: pointer;">
      Status <i class="fa" [ngClass]="{'fa-sort-up': sortColumn === 'status' && sortOrder, 'fa-sort-down': sortColumn === 'status' && !sortOrder}"></i>
    </th>
    <th class="align-middle" (click)="toggleSort('date')" style="cursor: pointer;">
      Date <i class="fa" [ngClass]="{'fa-sort-up': sortColumn === 'date' && sortOrder, 'fa-sort-down': sortColumn === 'date' && !sortOrder}"></i>
    </th>
    <th>Actions</th>
  </tr>
</thead>
        <tbody>
          <tr *ngFor="let ticket of tickets | filter: searchTerm">
            <td>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="ticketCheck{{ticket.ticketId}}">
                <label class="form-check-label" for="ticketCheck{{ticket.ticketId}}"></label>
              </div>
            </td>
            <td>
              <a href="javascript:void(0);" class="text-body fw-bold">{{ticket.ticketId}}</a>
            </td>
            <td>{{ticket.description}}</td>
            <td>
              <ng-container *ngIf="ticket.status === 'Open'; else closedStatus">
                <span
                  class="badge rounded-pill text-bg-success fw-bold d-block mb-1 fs-6"
                >
                  {{ ticket.status }}
                </span>
              </ng-container>
              <ng-template #closedStatus>
                <span
                  class="badge rounded-pill text-bg-danger fw-bold d-block mb-1 fs-6"
                >
                  {{ ticket.status }}
                </span>
              </ng-template>
            </td>
            
            <td>{{ ticket.date | date: 'MMMM-dd-yyyy' }}</td>
            <td>
              <button class="btn btn-sm btn-primary me-2" (click)="editTicket(ticket)">
                <i class="fa fa-edit me-1"></i> Update
              </button>
              <button class="btn btn-sm btn-danger" (click)="deleteTicket(ticket)">
                <i class="fa fa-trash me-1"></i> Delete
              </button>
            </td>
          </tr>
        </tbody>
      </table>
      <div class="text-start mt-3">
        <button class="btn btn-primary" (click)="createNewTicket()">Add New</button>
      </div>
    </div>
  </div>
</div>



<!-- Create Ticket Modal -->
<div class="modal fade" id="createTicketModal" tabindex="-1" aria-labelledby="createTicketModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="createTicketModalLabel">Create New Ticket</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="ticketForm" (ngSubmit)="saveTicket()">
          <div class="mb-3">
            <label for="description" class="form-label">Description</label>
            <input type="text" id="description"  class="form-control" formControlName="description" />
            <div *ngIf="ticketForm.get('description')?.invalid && ticketForm.get('description')?.touched" class="error-message">
              <div *ngIf="ticketForm.get('description')?.errors?.['required']">
                Description is required.
              </div>
              <div *ngIf="ticketForm.get('description')?.errors?.['minlength']">
                {{ ticketForm.get('description')?.errors?.['minlength']?.requiredLength }} characters required.
              </div>
            </div>            
          </div>
        
          <div class="mb-3">
            <label for="status" class="form-label">Status</label>
            <select id="status" class="form-select" formControlName="status">
              <option value="" disabled>Select Status</option>
              <option value="Open">Open</option>
              <option value="Closed">Closed</option>
            </select>
            <div *ngIf="ticketForm.get('status')?.invalid && ticketForm.get('status')?.touched" class="error-message">
              <div *ngIf="ticketForm.get('status')?.errors?.['required']">
                Status is required.
              </div>
              <div *ngIf="ticketForm.get('status')?.errors?.['oneOf']">
                Invalid status.
              </div>
            </div>
          </div>
        
          <div class="mb-3">
            <label for="date" class="form-label">Date</label>
            <input type="date" id="date" class="form-control" formControlName="date" />
            <div *ngIf="ticketForm.get('date')?.invalid && ticketForm.get('date')?.touched" class="error-message">
              <div *ngIf="ticketForm.get('date')?.errors?.['required']">
                Date is required.
              </div>
              <div *ngIf="ticketForm.get('date')?.errors?.['typeError']">
                {{ ticketForm.get('date')?.errors?.['typeError'] }}
              </div>
            </div>
          </div>
          <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Create Ticket</button>
        </div>
        </form>        
      </div>
    </div>
  </div>
</div>


<!-- Edit Ticket Modal -->
<div class="modal fade" id="editTicketModal" tabindex="-1" aria-labelledby="editTicketModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editTicketModalLabel">Edit Ticket</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="ticketForm" (ngSubmit)="saveTicket()">
          <div class="mb-3">
            <label for="description" class="form-label">Description</label>
            <input type="text" id="description" class="form-control" formControlName="description">
          </div>
          <div class="mb-3">
            <label for="status" class="form-label">Status</label>
            <select id="status" class="form-select" formControlName="status">
              <option value="Open">Open</option>
              <option value="Closed">Closed</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="date" class="form-label">Date</label>
            <input type="date" id="date" class="form-control" formControlName="date" />
          </div>
          <!-- Move submit button inside form -->
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>


